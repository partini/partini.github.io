<!DOCTYPE html>
<html>
  <head>
    <title>A quick guide on building a WhatsAPP Chat Bot with DialogFlow – Incodeks – Moving the world forward through top notch software.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>
    <link rel="icon" 
      type="image/png" 
      href="/assets/img/favicon.png" sizes="16x16">

    
    <meta name="description" content="The purpose of this article is to set up an integration deployment to connect your existing Dialogflow agent with Twilio chat service platform. If you are a developer who uses Dialogflow to create different Dialoglow Agents who communicate with WhatsAPP, then you will definitely need this article." />
    <meta property="og:description" content="The purpose of this article is to set up an integration deployment to connect your existing Dialogflow agent with Twilio chat service platform. If you are a developer who uses Dialogflow to create different Dialoglow Agents who communicate with WhatsAPP, then you will definitely need this article." />
    
    <meta name="author" content="Incodeks" />

    
    <meta property="og:title" content="A quick guide on building a WhatsAPP Chat Bot with DialogFlow" />
    <meta property="twitter:title" content="A quick guide on building a WhatsAPP Chat Bot with DialogFlow" />
    
    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
 
    <link rel="alternate" type="application/rss+xml" title="Incodeks - Moving the world forward through top notch software." href="/feed.xml" />
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/FontAwesome.css">
    <link rel="stylesheet" href="/assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link href="https://fonts.cdnfonts.com/css/heebo" rel="stylesheet">

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->

    <!-- Autopilot incodeks capture code -->
    <script>
      window.ap3c = window.ap3c || {};
      var ap3c = window.ap3c;
      ap3c.cmd = ap3c.cmd || [];
      ap3c.cmd.push(function() {
        ap3c.init('YMH6zD_VsQ2Z8J-BaW5jb2Rla3M', 'https://capture-api.autopilotapp.com/');
        ap3c.track({v: 0});
      });
      var s, t; s = document.createElement('script'); s.type = 'text/javascript'; s.src = "https://s.autopilotapp.com/app.js";
      t = document.getElementsByTagName('script')[0]; t.parentNode.insertBefore(s, t);
    </script>
  </head>

  <body  id="page-top">
  <nav class="  navbar navbar-dark navbar-expand-lg fixed-top navbar navbar-transparent navbar-expand-lg fixed-top bg-transparent" id="mainNav">
    <div class="container-fluid">
      <a class="navbar-brand" href="https://incodeks.com/">
      <img src="/assets/img/logo.png" style="width: 60px;">
    </a>
      <button class="navbar-toggler navbar-toggler-right bg-transparent" id="menu_burger">
        <i class="fa fa-bars  fa-2x"></i>
      </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto text-uppercase">
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="/about">About us</a></li>
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="/services">Services</a></li>
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="/insights">insights</a></li>
                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="/careers">careers</a></li>
                <li class="nav-item"></li>
                <li class="nav-item"></li>
                <li class="nav-item  estimate-button"><a class="nav-link js-scroll-trigger" href="/estimate" >Free Estimate</a></li>
            </ul>
        </div>
    </div>
</nav>

        <header class="masthead-singlearticle" style="background: url('/assets/posts/whatsapp.webp') center / cover no-repeat !important ">
        <div class="image" ></div>
    </header>
    
    <section style="padding-top: 0px; background: linear-gradient(138deg, white 85%, blue 140%);">
        <div class="container pt-4">
            <div class="row">
                <div class="col-lg-8 col-md-8 col-sm-12 col-12 first-col-singlearticle">
                    <p class="font-weight-bold">A quick guide on building a WhatsAPP Chat Bot with DialogFlow</p>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-12"></div>
                <!-- <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 col-12 second-col-singlearticle">
                    <div id="paragraphs">
                        <p class="text-sm-left text-md-left text-lg-center text-xl-center">Written on June  1, 2021 <br/> <h2 id="introduction">Introduction</h2>

<p>I am Arlind Kerqeli, I have been working as an Engineer Software at Incodeks for more than 3 years now. As many of us know, Dialogflow on June 6  2020, has stopped the integration of many platforms that it had automatically, and from now on the implementation of these integrations has shifted to an open source. The purpose of this article is to set up an integration deployment to connect your existing Dialogflow agent with Twilio chat service platform. If you are a developer who uses Dialogflow to create different Dialogflow Agents who communicate with WhatsAPP, then you will definitely need this article.</p>

<p>If you do not have an existing Dialogflow agent, you can set one up by reading the documentation <a href="https://cloud.google.com/dialogflow/docs/" target="_blank">here</a></p>

<h2 id="initial-setup">Initial Setup</h2>
<p>Setting up G Cloud CLI</p>

<p>The deployment process for GCP Cloud Run via this article utilizes G Cloud CLI commands. Follow the steps below to set up G Cloud CLI locally for this deployment.</p>

<ol>
  <li>On the G Cloud CLI <a href="https://cloud.google.com/sdk/docs/quickstarts">documentation page </a>, select your OS and follow the instructions for the installation.</li>
  <li>Run G Cloud config get-value project to check the GCP Project configured.</li>
  <li>Go into the Dialogflow agent’s settings and check the Project ID associated with the agent. The GCP Project configured in the G Cloud CLI should match the agent’s Project ID.</li>
  <li>If the project IDs do not match, run G Cloud config set project PROJECT-ID, replacing PROJECT-ID with the Project ID from step 3.</li>
</ol>

<h2 id="service-account-setup-gcp">Service Account Setup (GCP)</h2>
<p>For the integration to function properly, it is necessary to create a Service Account in your agent’s GCP Project. See this page of the documentation for more details.
<br />
Follow the steps below to create a Service Account and set up the integration.
<br /></p>
<ol>
  <li>Go into the Dialogflow agent’s settings and click on the Project ID link to open its associated GCP Project.</li>
  <li>Click on the navigation menu in the GCP console, hover over “IAM &amp; admin”, and click “Service accounts”.</li>
  <li>Click on “+ CREATE SERVICE ACCOUNT”, fill in the details, and give it the “Dialogflow Client API” role.</li>
  <li>Click on “+ Create Key” and download the resulting JSON key file.</li>
  <li>Save the JSON key file in the twilio platform subdirectory.
<br />
<br />
If deploying this integration outside of GCP Cloud Run, it may be necessary to set the GOOGLE_APPLICATION_CREDENTIALS environmental variable on the deployment environment to the absolute path of the Service Account JSON key file. See this guide for details.</li>
</ol>

<h2 id="deploying-the-integration">Deploying the Integration</h2>
<h3 id="setup">Setup</h3>

<ol>
  <li>Go into the Dialogflow agent’s settings and click on the Project ID link to open its associated GCP Project.</li>
  <li>Click on the navigation menu in the GCP console and click “Billing”. Set up and enable billing for the project.</li>
  <li>Enable Cloud Build and Cloud Run API for the project here.</li>
  <li>Clone this git repository onto your local machine or development environment: git clone https://github.com/GoogleCloudPlatform/dialogflow-integrations.git</li>
  <li>Open the root directory of the repository on your local machine or development environment.</li>
</ol>

<h2 id="dockerfile-and-creating-the-build">Dockerfile and Creating the Build</h2>

<p>Open the <a href="https://github.com/GoogleCloudPlatform/dialogflow-integrations/blob/03676af04840c21c12e2590393d5542602591bee/Dockerfile#L9" target="_blank">Dockerfile </a> in the root directory of the repository, and change YOUR_INTEGRATION in the following line to “Twilio”
<br />
<br />
   ENV INTEGRATION=YOUR_INTEGRATION  → ENV INTEGRATION=twilio
   <br />
<br />
If you have not done so already, copy your Service Account JSON key file to the Twilio platform subdirectory.</p>

<h2 id="twilio-text-messaging-integration">Twilio (Text Messaging) Integration</h2>
<h3 id="setup-prerequisites">Setup Prerequisites</h3>

<ol>
  <li>Create a <a href="https://www.twilio.com/try-twilio" target="_blank">Twilio account.</a></li>
  <li>Replace the value of projectId in the server.js file with your Dialogflow agent’s Project ID.</li>
</ol>

<h3 id="retrieving-credentials">Retrieving Credentials</h3>

<ol>
  <li>Log in to the <a href="https://www.twilio.com/console">Twilio Dashboard.</a>
<br /></li>
  <li>Under the “Project Info” section, take the values for Account SID and Auth Token and replace the value for accountSid and authToken in the <a href="https://github.com/GoogleCloudPlatform/dialogflow-integrations/blob/03676af04840c21c12e2590393d5542602591bee/twilio/server.js#L34-L35" target="_blank">server.js</a> file respectively. 
<br />
<img src="/assets/posts/unnamed11.png" style="width: 100%;height: 400px; object-fit:contain" /></li>
</ol>

<h3 id="deploying-the-integration-using-cloud-run">Deploying the Integration Using Cloud Run</h3>

<p>In your local terminal, change the active directory to the twilio root directory.</p>

<p>Run the following command to save the state of your repository into <a href="https://console.cloud.google.com/gcr/" target="_blank">GCP Container Registry.</a> Replace PROJECT-ID with your agent’s GCP Project ID.
<br /><br />
G Cloud builds submit –tag gcr.io/PROJECT-ID/dialogflow-twilio
<br /><br />
Deploy your integration to live using the following command. Replace PROJECT-ID with your agent’s GCP project Id and YOUR_KEY_FILE with the name (not path) of your Service Account JSON key file.
<br /><br />
G Cloud beta run deploy –image gcr.io/PROJECT-ID/dialogflow-twilio –update-env-vars GOOGLE_APPLICATION_CREDENTIALS=YOUR_KEY_FILE 
–memory 1Gi</p>

<ol>
  <li>hen prompted for a target platform, select a platform by entering the corresponding number (for example, 1 for Cloud Run (fully managed)).</li>
  <li>When prompted for a region, select a region (for example, us-central1).</li>
  <li>When prompted for a service name hit enter to accept the default.</li>
  <li>When prompted to allow unauthenticated invocations press y.</li>
  <li>Copy the URL given to you, and use it according to the README file in the given integration’s folder.</li>
</ol>

<h2 id="setting-up-phone-number">Setting up Phone Number</h2>
<ol>
  <li>In the “Phone Number” section, go to Active numbers.</li>
  <li>Click on the purchased number.</li>
  <li>Underneath “Messaging”, take the value for the server URL printed in the console after the completion of the execution of the last command from the above section to the “A message comes in” fill-in box. Set the first drop-down to Webhook and the HTTP method to HTTP POST.
<img src="/assets/posts/unnamed12.png" style="width: 100%;height: 250px; object-fit:contain" />
<br /><br />
If you don’t understand anything or need help with this article please contact arlind@incodeks.com.
<br /><br />
Thank you for your attention.</li>
</ol>

<h3 id="author-arlind-kerqeli">Author: Arlind Kerqeli</h3>
</p>

                    </div>
                </div> -->
                <div class="col-lg-3 col-md-12 col-sm-12 col-12"></div>
                <div class="col-lg-9 col-md-12 cols-sm-12 col-12">
                    <h2 id="introduction">Introduction</h2>

<p>I am Arlind Kerqeli, I have been working as an Engineer Software at Incodeks for more than 3 years now. As many of us know, Dialogflow on June 6  2020, has stopped the integration of many platforms that it had automatically, and from now on the implementation of these integrations has shifted to an open source. The purpose of this article is to set up an integration deployment to connect your existing Dialogflow agent with Twilio chat service platform. If you are a developer who uses Dialogflow to create different Dialogflow Agents who communicate with WhatsAPP, then you will definitely need this article.</p>

<p>If you do not have an existing Dialogflow agent, you can set one up by reading the documentation <a href="https://cloud.google.com/dialogflow/docs/" target="_blank">here</a></p>

<h2 id="initial-setup">Initial Setup</h2>
<p>Setting up G Cloud CLI</p>

<p>The deployment process for GCP Cloud Run via this article utilizes G Cloud CLI commands. Follow the steps below to set up G Cloud CLI locally for this deployment.</p>

<ol>
  <li>On the G Cloud CLI <a href="https://cloud.google.com/sdk/docs/quickstarts">documentation page </a>, select your OS and follow the instructions for the installation.</li>
  <li>Run G Cloud config get-value project to check the GCP Project configured.</li>
  <li>Go into the Dialogflow agent’s settings and check the Project ID associated with the agent. The GCP Project configured in the G Cloud CLI should match the agent’s Project ID.</li>
  <li>If the project IDs do not match, run G Cloud config set project PROJECT-ID, replacing PROJECT-ID with the Project ID from step 3.</li>
</ol>

<h2 id="service-account-setup-gcp">Service Account Setup (GCP)</h2>
<p>For the integration to function properly, it is necessary to create a Service Account in your agent’s GCP Project. See this page of the documentation for more details.
<br />
Follow the steps below to create a Service Account and set up the integration.
<br /></p>
<ol>
  <li>Go into the Dialogflow agent’s settings and click on the Project ID link to open its associated GCP Project.</li>
  <li>Click on the navigation menu in the GCP console, hover over “IAM &amp; admin”, and click “Service accounts”.</li>
  <li>Click on “+ CREATE SERVICE ACCOUNT”, fill in the details, and give it the “Dialogflow Client API” role.</li>
  <li>Click on “+ Create Key” and download the resulting JSON key file.</li>
  <li>Save the JSON key file in the twilio platform subdirectory.
<br />
<br />
If deploying this integration outside of GCP Cloud Run, it may be necessary to set the GOOGLE_APPLICATION_CREDENTIALS environmental variable on the deployment environment to the absolute path of the Service Account JSON key file. See this guide for details.</li>
</ol>

<h2 id="deploying-the-integration">Deploying the Integration</h2>
<h3 id="setup">Setup</h3>

<ol>
  <li>Go into the Dialogflow agent’s settings and click on the Project ID link to open its associated GCP Project.</li>
  <li>Click on the navigation menu in the GCP console and click “Billing”. Set up and enable billing for the project.</li>
  <li>Enable Cloud Build and Cloud Run API for the project here.</li>
  <li>Clone this git repository onto your local machine or development environment: git clone https://github.com/GoogleCloudPlatform/dialogflow-integrations.git</li>
  <li>Open the root directory of the repository on your local machine or development environment.</li>
</ol>

<h2 id="dockerfile-and-creating-the-build">Dockerfile and Creating the Build</h2>

<p>Open the <a href="https://github.com/GoogleCloudPlatform/dialogflow-integrations/blob/03676af04840c21c12e2590393d5542602591bee/Dockerfile#L9" target="_blank">Dockerfile </a> in the root directory of the repository, and change YOUR_INTEGRATION in the following line to “Twilio”
<br />
<br />
   ENV INTEGRATION=YOUR_INTEGRATION  → ENV INTEGRATION=twilio
   <br />
<br />
If you have not done so already, copy your Service Account JSON key file to the Twilio platform subdirectory.</p>

<h2 id="twilio-text-messaging-integration">Twilio (Text Messaging) Integration</h2>
<h3 id="setup-prerequisites">Setup Prerequisites</h3>

<ol>
  <li>Create a <a href="https://www.twilio.com/try-twilio" target="_blank">Twilio account.</a></li>
  <li>Replace the value of projectId in the server.js file with your Dialogflow agent’s Project ID.</li>
</ol>

<h3 id="retrieving-credentials">Retrieving Credentials</h3>

<ol>
  <li>Log in to the <a href="https://www.twilio.com/console">Twilio Dashboard.</a>
<br /></li>
  <li>Under the “Project Info” section, take the values for Account SID and Auth Token and replace the value for accountSid and authToken in the <a href="https://github.com/GoogleCloudPlatform/dialogflow-integrations/blob/03676af04840c21c12e2590393d5542602591bee/twilio/server.js#L34-L35" target="_blank">server.js</a> file respectively. 
<br />
<img src="/assets/posts/unnamed11.png" style="width: 100%;height: 400px; object-fit:contain" /></li>
</ol>

<h3 id="deploying-the-integration-using-cloud-run">Deploying the Integration Using Cloud Run</h3>

<p>In your local terminal, change the active directory to the twilio root directory.</p>

<p>Run the following command to save the state of your repository into <a href="https://console.cloud.google.com/gcr/" target="_blank">GCP Container Registry.</a> Replace PROJECT-ID with your agent’s GCP Project ID.
<br /><br />
G Cloud builds submit –tag gcr.io/PROJECT-ID/dialogflow-twilio
<br /><br />
Deploy your integration to live using the following command. Replace PROJECT-ID with your agent’s GCP project Id and YOUR_KEY_FILE with the name (not path) of your Service Account JSON key file.
<br /><br />
G Cloud beta run deploy –image gcr.io/PROJECT-ID/dialogflow-twilio –update-env-vars GOOGLE_APPLICATION_CREDENTIALS=YOUR_KEY_FILE 
–memory 1Gi</p>

<ol>
  <li>hen prompted for a target platform, select a platform by entering the corresponding number (for example, 1 for Cloud Run (fully managed)).</li>
  <li>When prompted for a region, select a region (for example, us-central1).</li>
  <li>When prompted for a service name hit enter to accept the default.</li>
  <li>When prompted to allow unauthenticated invocations press y.</li>
  <li>Copy the URL given to you, and use it according to the README file in the given integration’s folder.</li>
</ol>

<h2 id="setting-up-phone-number">Setting up Phone Number</h2>
<ol>
  <li>In the “Phone Number” section, go to Active numbers.</li>
  <li>Click on the purchased number.</li>
  <li>Underneath “Messaging”, take the value for the server URL printed in the console after the completion of the execution of the last command from the above section to the “A message comes in” fill-in box. Set the first drop-down to Webhook and the HTTP method to HTTP POST.
<img src="/assets/posts/unnamed12.png" style="width: 100%;height: 250px; object-fit:contain" />
<br /><br />
If you don’t understand anything or need help with this article please contact arlind@incodeks.com.
<br /><br />
Thank you for your attention.</li>
</ol>

<h3 id="author-arlind-kerqeli">Author: Arlind Kerqeli</h3>

                    
                </div>
                
            </div>
        </div>
    </section>
 
  
    <section id="footer" class="section bg-black padding-7">
  <div class="row">

      <div class="col-lg-6 col-md-6 left_footer_grid">
        <div class="d-flex justify-content-end">
          
            <p class="get_in_touch_text_1">Have a project in mind? <br/> Let's work together.</p>
          
        </div>
        <div class="d-flex justify-content-end pr-5">
          <img src="/assets/img/icon-footer.png" alt=""> 
        </div>
      </div>

      <div class="col-lg-6 col-md-6 right_footer_grid">
          <a href="/estimate">
            
              Contact us
            
          </a>
      </div>

  </div>

  <div class="footer-bottom pt-4 pb-4">
    <div class="row">

      <div class="col-lg-6">
        <ul class="mb-0">
          <li class="list-inline-item"><a href="/about/">About us</a></li>
          <li class="list-inline-item"><a href="/services/">Services</a></li>
          <li class="list-inline-item"><a href="/careers/">Careers</a></li>
          <li class="list-inline-item"><a href="/insights/">Insights</a></li>
        </ul>
      </div>

      <div class="col-lg-6 d-flex">
        <div class="position-relative back_top_grid">
          <a class="back_top" >BACK TO TOP</a>
          <a class="back_top img" ><img src="/assets/img/back_top.png" alt=""> </a>
        </div>
        <div class="right_bottom_footer_grid">
          <ul class="mb-0">
            <li class="list-inline-item"><a href="https://www.facebook.com/incodeks" target="_blank">Facebook</a></li>
            <li class="list-inline-item"><a href="https://www.instagram.com/incodeks" target="_blank">Instagram</a></li>
            <li class="list-inline-item"><a href="https://www.linkedin.com/company/incodeks" target="_blank">LinkedIn</a></li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</section>
   
  
    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-173215798-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/guide-on-building-whatsapp-chatbot-with-dialogflow/',
		  'title': 'A quick guide on building a WhatsAPP Chat Bot with DialogFlow'
		});
	</script>
	<!-- End Google Analytics -->



    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="/assets/js/agency.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="/assets/js/global.js"></script>
  </body>
</html>
